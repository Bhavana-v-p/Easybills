<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>EasyBills</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #events { margin-top: 20px; }
    .event { padding: 8px; border-bottom: 1px solid #eee; }
  </style>
</head>
<body>
  <h1>EasyBills</h1>
  <p>Enter your user id (facultyId) to join your notification room and receive real-time updates.</p>
  <input id="userId" placeholder="Enter user id" />
  <button id="connectBtn">Connect</button>
  <button id="disconnectBtn" disabled>Disconnect</button>

  <div id="status"></div>

  <div id="events"></div>

  <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  <script>
    let socket;
    const connectBtn = document.getElementById('connectBtn');
    const disconnectBtn = document.getElementById('disconnectBtn');
    const userIdInput = document.getElementById('userId');
    const events = document.getElementById('events');
    const status = document.getElementById('status');

    connectBtn.addEventListener('click', () => {
      const userId = userIdInput.value.trim();
      if (!userId) return alert('Enter a user id to join');

      // Connect to backend Socket.io server (adjust origin if needed)
      socket = io('http://localhost:5173', { // <--- Production API Link
        withCredentials: true
      });

      socket.on('connect', () => {
        status.innerText = 'Connected as ' + socket.id;
        socket.emit('join', { userId });
        connectBtn.disabled = true;
        disconnectBtn.disabled = false;
      });

      socket.on('claimStatusUpdated', (data) => {
        const div = document.createElement('div');
        div.className = 'event';
        div.innerText = `Claim ${data.claimId} status updated: ${data.status}`;
        events.prepend(div);
      });

      socket.on('documentUploaded', (data) => {
        const div = document.createElement('div');
        div.className = 'event';
        div.innerText = `Document uploaded for claim ${data.claimId}: ${data.fileName}`;
        events.prepend(div);
      });

      socket.on('claimUpdated', (data) => {
        const div = document.createElement('div');
        div.className = 'event';
        div.innerText = `Claim updated: ${JSON.stringify(data)}`;
        events.prepend(div);
      });

      socket.on('disconnect', () => {
        status.innerText = 'Disconnected';
        connectBtn.disabled = false;
        disconnectBtn.disabled = true;
      });
    });

    disconnectBtn.addEventListener('click', () => {
      if (socket) socket.disconnect();
    });
  </script>
</body>
</html>
